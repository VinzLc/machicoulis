{"ast":null,"code":"'use strict';\n\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.PinpointEventBuffer = void 0;\nconst Logger_1 = require(\"../../../Logger\");\nconst pinpoint_1 = require(\"../../../awsClients/pinpoint\");\nconst haveCredentialsChanged_1 = require(\"../../../utils/haveCredentialsChanged\");\nconst isAppInForeground_1 = require(\"./isAppInForeground\");\nconst logger = new Logger_1.ConsoleLogger('PinpointEventBuffer');\nconst RETRYABLE_CODES = [429, 500];\nconst ACCEPTED_CODES = [202];\nclass PinpointEventBuffer {\n  constructor(config) {\n    this._interval = undefined;\n    this._pause = false;\n    this._flush = false;\n    this._buffer = [];\n    this._config = config;\n    this._sendBatch = this._sendBatch.bind(this);\n    this._startLoop();\n  }\n  push(event) {\n    if (this._buffer.length >= this._config.bufferSize) {\n      logger.debug('Exceeded Pinpoint event buffer limits, event dropped.', {\n        eventId: event.eventId\n      });\n      return;\n    }\n    this._buffer.push({\n      [event.eventId]: event\n    });\n  }\n  pause() {\n    this._pause = true;\n  }\n  resume() {\n    this._pause = false;\n  }\n  flush() {\n    this._flush = true;\n  }\n  identityHasChanged(identityId) {\n    return this._config.identityId !== identityId;\n  }\n  haveCredentialsChanged(credentials) {\n    return (0, haveCredentialsChanged_1.haveCredentialsChanged)(this._config.credentials, credentials);\n  }\n  flushAll() {\n    this._putEvents(this._buffer.splice(0, this._buffer.length));\n  }\n  _startLoop() {\n    if (this._interval) {\n      clearInterval(this._interval);\n    }\n    const {\n      flushInterval\n    } = this._config;\n    this._interval = setInterval(this._sendBatch, flushInterval);\n  }\n  _sendBatch() {\n    const bufferLength = this._buffer.length;\n    if (this._flush && !bufferLength && this._interval) {\n      clearInterval(this._interval);\n    }\n    if (this._pause || !bufferLength || !(0, isAppInForeground_1.isAppInForeground)()) {\n      return;\n    }\n    const {\n      flushSize\n    } = this._config;\n    const batchSize = Math.min(flushSize, bufferLength);\n    const bufferSubset = this._buffer.splice(0, batchSize);\n    this._putEvents(bufferSubset);\n  }\n  async _putEvents(buffer) {\n    const eventMap = this._bufferToMap(buffer);\n    const batchEventParams = this._generateBatchEventParams(eventMap);\n    try {\n      const {\n        credentials,\n        region,\n        userAgentValue\n      } = this._config;\n      const data = await (0, pinpoint_1.putEvents)({\n        credentials,\n        region,\n        userAgentValue\n      }, batchEventParams);\n      this._processPutEventsSuccessResponse(data, eventMap);\n    } catch (err) {\n      this._handlePutEventsFailure(err, eventMap);\n    }\n  }\n  _generateBatchEventParams(eventMap) {\n    const batchItem = {};\n    Object.values(eventMap).forEach(item => {\n      const {\n        event,\n        timestamp,\n        endpointId,\n        eventId,\n        session\n      } = item;\n      const {\n        name,\n        attributes,\n        metrics\n      } = event;\n      batchItem[endpointId] = {\n        Endpoint: {\n          ...batchItem[endpointId]?.Endpoint\n        },\n        Events: {\n          ...batchItem[endpointId]?.Events,\n          [eventId]: {\n            EventType: name,\n            Timestamp: new Date(timestamp).toISOString(),\n            Attributes: attributes,\n            Metrics: metrics,\n            Session: session\n          }\n        }\n      };\n    });\n    return {\n      ApplicationId: this._config.appId,\n      EventsRequest: {\n        BatchItem: batchItem\n      }\n    };\n  }\n  _handlePutEventsFailure(err, eventMap) {\n    logger.debug('putEvents call to Pinpoint failed.', err);\n    const statusCode = err.$metadata && err.$metadata.httpStatusCode;\n    if (RETRYABLE_CODES.includes(statusCode)) {\n      const retryableEvents = Object.values(eventMap);\n      this._retry(retryableEvents);\n    }\n  }\n  _processPutEventsSuccessResponse(data, eventMap) {\n    const {\n      Results = {}\n    } = data.EventsResponse ?? {};\n    const retryableEvents = [];\n    Object.entries(Results).forEach(([_, endpointValues]) => {\n      const responses = endpointValues.EventsItemResponse ?? {};\n      Object.entries(responses).forEach(([eventId, eventValues]) => {\n        const eventObject = eventMap[eventId];\n        if (!eventObject) {\n          return;\n        }\n        const {\n          StatusCode,\n          Message\n        } = eventValues ?? {};\n        if (StatusCode && ACCEPTED_CODES.includes(StatusCode)) {\n          return;\n        }\n        if (StatusCode && RETRYABLE_CODES.includes(StatusCode)) {\n          retryableEvents.push(eventObject);\n          return;\n        }\n        const {\n          name\n        } = eventObject.event;\n        logger.warn('Pinpoint event failed to send.', {\n          eventId,\n          name,\n          message: Message\n        });\n      });\n    });\n    if (retryableEvents.length) {\n      this._retry(retryableEvents);\n    }\n  }\n  _retry(retryableEvents) {\n    // retryable events that haven't reached the resendLimit\n    const eligibleEvents = [];\n    retryableEvents.forEach(bufferedEvent => {\n      const {\n        eventId\n      } = bufferedEvent;\n      const {\n        name\n      } = bufferedEvent.event;\n      if (bufferedEvent.resendLimit-- > 0) {\n        logger.debug('Resending event.', {\n          eventId,\n          name,\n          remainingAttempts: bufferedEvent.resendLimit\n        });\n        eligibleEvents.push({\n          [eventId]: bufferedEvent\n        });\n        return;\n      }\n      logger.debug('No retry attempts remaining for event.', {\n        eventId,\n        name\n      });\n    });\n    // add the events to the front of the buffer\n    this._buffer.unshift(...eligibleEvents);\n  }\n  _bufferToMap(buffer) {\n    return buffer.reduce((acc, curVal) => {\n      const [[key, value]] = Object.entries(curVal);\n      acc[key] = value;\n      return acc;\n    }, {});\n  }\n}\nexports.PinpointEventBuffer = PinpointEventBuffer;","map":{"version":3,"names":["Object","defineProperty","exports","value","PinpointEventBuffer","Logger_1","require","pinpoint_1","haveCredentialsChanged_1","isAppInForeground_1","logger","ConsoleLogger","RETRYABLE_CODES","ACCEPTED_CODES","constructor","config","_interval","undefined","_pause","_flush","_buffer","_config","_sendBatch","bind","_startLoop","push","event","length","bufferSize","debug","eventId","pause","resume","flush","identityHasChanged","identityId","haveCredentialsChanged","credentials","flushAll","_putEvents","splice","clearInterval","flushInterval","setInterval","bufferLength","isAppInForeground","flushSize","batchSize","Math","min","bufferSubset","buffer","eventMap","_bufferToMap","batchEventParams","_generateBatchEventParams","region","userAgentValue","data","putEvents","_processPutEventsSuccessResponse","err","_handlePutEventsFailure","batchItem","values","forEach","item","timestamp","endpointId","session","name","attributes","metrics","Endpoint","Events","EventType","Timestamp","Date","toISOString","Attributes","Metrics","Session","ApplicationId","appId","EventsRequest","BatchItem","statusCode","$metadata","httpStatusCode","includes","retryableEvents","_retry","Results","EventsResponse","entries","_","endpointValues","responses","EventsItemResponse","eventValues","eventObject","StatusCode","Message","warn","message","eligibleEvents","bufferedEvent","resendLimit","remainingAttempts","unshift","reduce","acc","curVal","key"],"sources":["C:\\Users\\vinzl\\workspace\\machicoulis\\daily-image-collector\\node_modules\\@aws-amplify\\core\\src\\providers\\pinpoint\\utils\\PinpointEventBuffer.ts"],"sourcesContent":["\"use strict\";\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PinpointEventBuffer = void 0;\nconst Logger_1 = require(\"../../../Logger\");\nconst pinpoint_1 = require(\"../../../awsClients/pinpoint\");\nconst haveCredentialsChanged_1 = require(\"../../../utils/haveCredentialsChanged\");\nconst isAppInForeground_1 = require(\"./isAppInForeground\");\nconst logger = new Logger_1.ConsoleLogger('PinpointEventBuffer');\nconst RETRYABLE_CODES = [429, 500];\nconst ACCEPTED_CODES = [202];\nclass PinpointEventBuffer {\n    constructor(config) {\n        this._interval = undefined;\n        this._pause = false;\n        this._flush = false;\n        this._buffer = [];\n        this._config = config;\n        this._sendBatch = this._sendBatch.bind(this);\n        this._startLoop();\n    }\n    push(event) {\n        if (this._buffer.length >= this._config.bufferSize) {\n            logger.debug('Exceeded Pinpoint event buffer limits, event dropped.', {\n                eventId: event.eventId,\n            });\n            return;\n        }\n        this._buffer.push({ [event.eventId]: event });\n    }\n    pause() {\n        this._pause = true;\n    }\n    resume() {\n        this._pause = false;\n    }\n    flush() {\n        this._flush = true;\n    }\n    identityHasChanged(identityId) {\n        return this._config.identityId !== identityId;\n    }\n    haveCredentialsChanged(credentials) {\n        return (0, haveCredentialsChanged_1.haveCredentialsChanged)(this._config.credentials, credentials);\n    }\n    flushAll() {\n        this._putEvents(this._buffer.splice(0, this._buffer.length));\n    }\n    _startLoop() {\n        if (this._interval) {\n            clearInterval(this._interval);\n        }\n        const { flushInterval } = this._config;\n        this._interval = setInterval(this._sendBatch, flushInterval);\n    }\n    _sendBatch() {\n        const bufferLength = this._buffer.length;\n        if (this._flush && !bufferLength && this._interval) {\n            clearInterval(this._interval);\n        }\n        if (this._pause || !bufferLength || !(0, isAppInForeground_1.isAppInForeground)()) {\n            return;\n        }\n        const { flushSize } = this._config;\n        const batchSize = Math.min(flushSize, bufferLength);\n        const bufferSubset = this._buffer.splice(0, batchSize);\n        this._putEvents(bufferSubset);\n    }\n    async _putEvents(buffer) {\n        const eventMap = this._bufferToMap(buffer);\n        const batchEventParams = this._generateBatchEventParams(eventMap);\n        try {\n            const { credentials, region, userAgentValue } = this._config;\n            const data = await (0, pinpoint_1.putEvents)({\n                credentials,\n                region,\n                userAgentValue,\n            }, batchEventParams);\n            this._processPutEventsSuccessResponse(data, eventMap);\n        }\n        catch (err) {\n            this._handlePutEventsFailure(err, eventMap);\n        }\n    }\n    _generateBatchEventParams(eventMap) {\n        const batchItem = {};\n        Object.values(eventMap).forEach(item => {\n            const { event, timestamp, endpointId, eventId, session } = item;\n            const { name, attributes, metrics } = event;\n            batchItem[endpointId] = {\n                Endpoint: {\n                    ...batchItem[endpointId]?.Endpoint,\n                },\n                Events: {\n                    ...batchItem[endpointId]?.Events,\n                    [eventId]: {\n                        EventType: name,\n                        Timestamp: new Date(timestamp).toISOString(),\n                        Attributes: attributes,\n                        Metrics: metrics,\n                        Session: session,\n                    },\n                },\n            };\n        });\n        return {\n            ApplicationId: this._config.appId,\n            EventsRequest: {\n                BatchItem: batchItem,\n            },\n        };\n    }\n    _handlePutEventsFailure(err, eventMap) {\n        logger.debug('putEvents call to Pinpoint failed.', err);\n        const statusCode = err.$metadata && err.$metadata.httpStatusCode;\n        if (RETRYABLE_CODES.includes(statusCode)) {\n            const retryableEvents = Object.values(eventMap);\n            this._retry(retryableEvents);\n        }\n    }\n    _processPutEventsSuccessResponse(data, eventMap) {\n        const { Results = {} } = data.EventsResponse ?? {};\n        const retryableEvents = [];\n        Object.entries(Results).forEach(([_, endpointValues]) => {\n            const responses = endpointValues.EventsItemResponse ?? {};\n            Object.entries(responses).forEach(([eventId, eventValues]) => {\n                const eventObject = eventMap[eventId];\n                if (!eventObject) {\n                    return;\n                }\n                const { StatusCode, Message } = eventValues ?? {};\n                if (StatusCode && ACCEPTED_CODES.includes(StatusCode)) {\n                    return;\n                }\n                if (StatusCode && RETRYABLE_CODES.includes(StatusCode)) {\n                    retryableEvents.push(eventObject);\n                    return;\n                }\n                const { name } = eventObject.event;\n                logger.warn('Pinpoint event failed to send.', {\n                    eventId,\n                    name,\n                    message: Message,\n                });\n            });\n        });\n        if (retryableEvents.length) {\n            this._retry(retryableEvents);\n        }\n    }\n    _retry(retryableEvents) {\n        // retryable events that haven't reached the resendLimit\n        const eligibleEvents = [];\n        retryableEvents.forEach((bufferedEvent) => {\n            const { eventId } = bufferedEvent;\n            const { name } = bufferedEvent.event;\n            if (bufferedEvent.resendLimit-- > 0) {\n                logger.debug('Resending event.', {\n                    eventId,\n                    name,\n                    remainingAttempts: bufferedEvent.resendLimit,\n                });\n                eligibleEvents.push({ [eventId]: bufferedEvent });\n                return;\n            }\n            logger.debug('No retry attempts remaining for event.', {\n                eventId,\n                name,\n            });\n        });\n        // add the events to the front of the buffer\n        this._buffer.unshift(...eligibleEvents);\n    }\n    _bufferToMap(buffer) {\n        return buffer.reduce((acc, curVal) => {\n            const [[key, value]] = Object.entries(curVal);\n            acc[key] = value;\n            return acc;\n        }, {});\n    }\n}\nexports.PinpointEventBuffer = PinpointEventBuffer;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}