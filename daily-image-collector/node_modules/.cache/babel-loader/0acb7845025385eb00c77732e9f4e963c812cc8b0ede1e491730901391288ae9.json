{"ast":null,"code":"'use strict';\n\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createUploadTask = exports.createDownloadTask = void 0;\nconst CanceledError_1 = require(\"../../../errors/CanceledError\");\nconst utils_1 = require(\"../../../utils\");\nconst createCancellableTask = ({\n  job,\n  onCancel\n}) => {\n  const state = 'IN_PROGRESS';\n  let canceledErrorMessage;\n  const cancelableTask = {\n    cancel: message => {\n      const {\n        state: taskState\n      } = cancelableTask;\n      if (taskState === 'CANCELED' || taskState === 'ERROR' || taskState === 'SUCCESS') {\n        utils_1.logger.debug(`This task cannot be canceled. State: ${taskState}`);\n        return;\n      }\n      cancelableTask.state = 'CANCELED';\n      canceledErrorMessage = message;\n      onCancel(canceledErrorMessage);\n    },\n    state\n  };\n  const wrappedJobPromise = (async () => {\n    try {\n      const result = await job();\n      cancelableTask.state = 'SUCCESS';\n      return result;\n    } catch (e) {\n      if ((0, CanceledError_1.isCancelError)(e)) {\n        cancelableTask.state = 'CANCELED';\n        e.message = canceledErrorMessage ?? e.message;\n      }\n      cancelableTask.state = 'ERROR';\n      throw e;\n    }\n  })();\n  return Object.assign(cancelableTask, {\n    result: wrappedJobPromise\n  });\n};\nexports.createDownloadTask = createCancellableTask;\nconst createUploadTask = ({\n  job,\n  onCancel,\n  onResume,\n  onPause,\n  isMultipartUpload\n}) => {\n  const cancellableTask = createCancellableTask({\n    job,\n    onCancel\n  });\n  const uploadTask = Object.assign(cancellableTask, {\n    pause: () => {\n      const {\n        state\n      } = uploadTask;\n      if (!isMultipartUpload || state !== 'IN_PROGRESS') {\n        utils_1.logger.debug(`This task cannot be paused. State: ${state}`);\n        return;\n      }\n      // TODO(eslint): remove this linter suppression.\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      uploadTask.state = 'PAUSED';\n      onPause?.();\n    },\n    resume: () => {\n      const {\n        state\n      } = uploadTask;\n      if (!isMultipartUpload || state !== 'PAUSED') {\n        utils_1.logger.debug(`This task cannot be resumed. State: ${state}`);\n        return;\n      }\n      // TODO(eslint): remove this linter suppression.\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      uploadTask.state = 'IN_PROGRESS';\n      onResume?.();\n    }\n  });\n  return uploadTask;\n};\nexports.createUploadTask = createUploadTask;","map":{"version":3,"names":["Object","defineProperty","exports","value","createUploadTask","createDownloadTask","CanceledError_1","require","utils_1","createCancellableTask","job","onCancel","state","canceledErrorMessage","cancelableTask","cancel","message","taskState","logger","debug","wrappedJobPromise","result","e","isCancelError","assign","onResume","onPause","isMultipartUpload","cancellableTask","uploadTask","pause","resume"],"sources":["C:\\Users\\vinzl\\workspace\\machicoulis\\daily-image-collector\\node_modules\\@aws-amplify\\storage\\src\\providers\\s3\\utils\\transferTask.ts"],"sourcesContent":["\"use strict\";\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createUploadTask = exports.createDownloadTask = void 0;\nconst CanceledError_1 = require(\"../../../errors/CanceledError\");\nconst utils_1 = require(\"../../../utils\");\nconst createCancellableTask = ({ job, onCancel, }) => {\n    const state = 'IN_PROGRESS';\n    let canceledErrorMessage;\n    const cancelableTask = {\n        cancel: (message) => {\n            const { state: taskState } = cancelableTask;\n            if (taskState === 'CANCELED' ||\n                taskState === 'ERROR' ||\n                taskState === 'SUCCESS') {\n                utils_1.logger.debug(`This task cannot be canceled. State: ${taskState}`);\n                return;\n            }\n            cancelableTask.state = 'CANCELED';\n            canceledErrorMessage = message;\n            onCancel(canceledErrorMessage);\n        },\n        state,\n    };\n    const wrappedJobPromise = (async () => {\n        try {\n            const result = await job();\n            cancelableTask.state = 'SUCCESS';\n            return result;\n        }\n        catch (e) {\n            if ((0, CanceledError_1.isCancelError)(e)) {\n                cancelableTask.state = 'CANCELED';\n                e.message = canceledErrorMessage ?? e.message;\n            }\n            cancelableTask.state = 'ERROR';\n            throw e;\n        }\n    })();\n    return Object.assign(cancelableTask, {\n        result: wrappedJobPromise,\n    });\n};\nexports.createDownloadTask = createCancellableTask;\nconst createUploadTask = ({ job, onCancel, onResume, onPause, isMultipartUpload, }) => {\n    const cancellableTask = createCancellableTask({\n        job,\n        onCancel,\n    });\n    const uploadTask = Object.assign(cancellableTask, {\n        pause: () => {\n            const { state } = uploadTask;\n            if (!isMultipartUpload || state !== 'IN_PROGRESS') {\n                utils_1.logger.debug(`This task cannot be paused. State: ${state}`);\n                return;\n            }\n            // TODO(eslint): remove this linter suppression.\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            uploadTask.state = 'PAUSED';\n            onPause?.();\n        },\n        resume: () => {\n            const { state } = uploadTask;\n            if (!isMultipartUpload || state !== 'PAUSED') {\n                utils_1.logger.debug(`This task cannot be resumed. State: ${state}`);\n                return;\n            }\n            // TODO(eslint): remove this linter suppression.\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            uploadTask.state = 'IN_PROGRESS';\n            onResume?.();\n        },\n    });\n    return uploadTask;\n};\nexports.createUploadTask = createUploadTask;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}