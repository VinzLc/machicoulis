{"ast":null,"code":"'use strict';\n\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.signingMiddlewareFactory = void 0;\nconst signatureV4_1 = require(\"./signer/signatureV4\");\nconst getSkewCorrectedDate_1 = require(\"./utils/getSkewCorrectedDate\");\nconst getUpdatedSystemClockOffset_1 = require(\"./utils/getUpdatedSystemClockOffset\");\n/**\n * Middleware that SigV4 signs request with AWS credentials, and correct system clock offset.\n * This middleware is expected to be placed after retry middleware.\n */\nconst signingMiddlewareFactory = ({\n  credentials,\n  region,\n  service,\n  uriEscapePath = true\n}) => {\n  let currentSystemClockOffset;\n  return (next, context) => async function signingMiddleware(request) {\n    currentSystemClockOffset = currentSystemClockOffset ?? 0;\n    const signRequestOptions = {\n      credentials: typeof credentials === 'function' ? await credentials({\n        forceRefresh: !!context?.isCredentialsExpired\n      }) : credentials,\n      signingDate: (0, getSkewCorrectedDate_1.getSkewCorrectedDate)(currentSystemClockOffset),\n      signingRegion: region,\n      signingService: service,\n      uriEscapePath\n    };\n    const signedRequest = await (0, signatureV4_1.signRequest)(request, signRequestOptions);\n    const response = await next(signedRequest);\n    // Update system clock offset if response contains date header, regardless of the status code.\n    // non-2xx response will still be returned from next handler instead of thrown, because it's\n    // only thrown by the retry middleware.\n    const dateString = getDateHeader(response);\n    if (dateString) {\n      currentSystemClockOffset = (0, getUpdatedSystemClockOffset_1.getUpdatedSystemClockOffset)(Date.parse(dateString), currentSystemClockOffset);\n    }\n    return response;\n  };\n};\nexports.signingMiddlewareFactory = signingMiddlewareFactory;\nconst getDateHeader = ({\n  headers\n} = {}) => headers?.date ?? headers?.Date ?? headers?.['x-amz-date'];","map":{"version":3,"names":["Object","defineProperty","exports","value","signingMiddlewareFactory","signatureV4_1","require","getSkewCorrectedDate_1","getUpdatedSystemClockOffset_1","credentials","region","service","uriEscapePath","currentSystemClockOffset","next","context","signingMiddleware","request","signRequestOptions","forceRefresh","isCredentialsExpired","signingDate","getSkewCorrectedDate","signingRegion","signingService","signedRequest","signRequest","response","dateString","getDateHeader","getUpdatedSystemClockOffset","Date","parse","headers","date"],"sources":["C:\\Users\\vinzl\\workspace\\machicoulis\\daily-image-collector\\node_modules\\@aws-amplify\\core\\src\\clients\\middleware\\signing\\middleware.ts"],"sourcesContent":["\"use strict\";\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.signingMiddlewareFactory = void 0;\nconst signatureV4_1 = require(\"./signer/signatureV4\");\nconst getSkewCorrectedDate_1 = require(\"./utils/getSkewCorrectedDate\");\nconst getUpdatedSystemClockOffset_1 = require(\"./utils/getUpdatedSystemClockOffset\");\n/**\n * Middleware that SigV4 signs request with AWS credentials, and correct system clock offset.\n * This middleware is expected to be placed after retry middleware.\n */\nconst signingMiddlewareFactory = ({ credentials, region, service, uriEscapePath = true, }) => {\n    let currentSystemClockOffset;\n    return (next, context) => async function signingMiddleware(request) {\n        currentSystemClockOffset = currentSystemClockOffset ?? 0;\n        const signRequestOptions = {\n            credentials: typeof credentials === 'function'\n                ? await credentials({\n                    forceRefresh: !!context?.isCredentialsExpired,\n                })\n                : credentials,\n            signingDate: (0, getSkewCorrectedDate_1.getSkewCorrectedDate)(currentSystemClockOffset),\n            signingRegion: region,\n            signingService: service,\n            uriEscapePath,\n        };\n        const signedRequest = await (0, signatureV4_1.signRequest)(request, signRequestOptions);\n        const response = await next(signedRequest);\n        // Update system clock offset if response contains date header, regardless of the status code.\n        // non-2xx response will still be returned from next handler instead of thrown, because it's\n        // only thrown by the retry middleware.\n        const dateString = getDateHeader(response);\n        if (dateString) {\n            currentSystemClockOffset = (0, getUpdatedSystemClockOffset_1.getUpdatedSystemClockOffset)(Date.parse(dateString), currentSystemClockOffset);\n        }\n        return response;\n    };\n};\nexports.signingMiddlewareFactory = signingMiddlewareFactory;\nconst getDateHeader = ({ headers } = {}) => headers?.date ?? headers?.Date ?? headers?.['x-amz-date'];\n"],"mappings":";;AACA;AACA;AACAA,MAAM,CAACC,cAAc,CAACC,OAAO,EAAE,YAAY,EAAE;EAAEC,KAAK,EAAE;AAAI,CAAE,CAAC;AAC7DD,OAAO,CAACE,wBAAwB,GAAG,MAAM;AACzC,MAAMC,aAAa,GAAGC,OAAO,CAAC,sBAAsB,CAAC;AACrD,MAAMC,sBAAsB,GAAGD,OAAO,CAAC,8BAA8B,CAAC;AACtE,MAAME,6BAA6B,GAAGF,OAAO,CAAC,qCAAqC,CAAC;AACpF;AACA;AACA;AACA;AACA,MAAMF,wBAAwB,GAAGA,CAAC;EAAEK,WAAW;EAAEC,MAAM;EAAEC,OAAO;EAAEC,aAAa,GAAG;AAAI,CAAG,KAAK;EAC1F,IAAIC,wBAAwB;EAC5B,OAAO,CAACC,IAAI,EAAEC,OAAO,KAAK,eAAeC,iBAAiBA,CAACC,OAAO,EAAE;IAChEJ,wBAAwB,GAAGA,wBAAwB,IAAI,CAAC;IACxD,MAAMK,kBAAkB,GAAG;MACvBT,WAAW,EAAE,OAAOA,WAAW,KAAK,aAC9B,MAAMA,WAAW,CAAC;QAChBU,YAAY,EAAE,CAAC,CAACJ,OAAO,EAAEK;MAC7C,CAAiB,IACCX,WAAW;MACjBY,WAAW,EAAE,IAAId,sBAAsB,CAACe,oBAAoB,EAAET,wBAAwB,CAAC;MACvFU,aAAa,EAAEb,MAAM;MACrBc,cAAc,EAAEb,OAAO;MACvBC;IACZ,CAAS;IACD,MAAMa,aAAa,GAAG,MAAM,IAAIpB,aAAa,CAACqB,WAAW,EAAET,OAAO,EAAEC,kBAAkB,CAAC;IACvF,MAAMS,QAAQ,GAAG,MAAMb,IAAI,CAACW,aAAa,CAAC;IAClD;IACA;IACA;IACQ,MAAMG,UAAU,GAAGC,aAAa,CAACF,QAAQ,CAAC;IAC1C,IAAIC,UAAU,EAAE;MACZf,wBAAwB,GAAG,IAAIL,6BAA6B,CAACsB,2BAA2B,EAAEC,IAAI,CAACC,KAAK,CAACJ,UAAU,CAAC,EAAEf,wBAAwB,CAAC;IACvJ;IACQ,OAAOc,QAAQ;EACvB,CAAK;AACL,CAAC;AACDzB,OAAO,CAACE,wBAAwB,GAAGA,wBAAwB;AAC3D,MAAMyB,aAAa,GAAGA,CAAC;EAAEI;AAAO,CAAE,GAAG,EAAE,KAAKA,OAAO,EAAEC,IAAI,IAAID,OAAO,EAAEF,IAAI,IAAIE,OAAO,GAAG,YAAY,CAAC","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}