{"ast":null,"code":"'use strict';\n\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.listObjectsV2 = void 0;\nconst aws_client_utils_1 = require(\"@aws-amplify/core/internals/aws-client-utils\");\nconst utils_1 = require(\"@aws-amplify/core/internals/utils\");\nconst composers_1 = require(\"@aws-amplify/core/internals/aws-client-utils/composers\");\nconst utils_2 = require(\"../utils\");\nconst IntegrityError_1 = require(\"../../../../../errors/IntegrityError\");\nconst deserializeHelpers_1 = require(\"../utils/deserializeHelpers\");\nconst base_1 = require(\"./base\");\nconst listObjectsV2Serializer = (input, endpoint) => {\n  const headers = (0, utils_2.assignStringVariables)({\n    'x-amz-request-payer': input.RequestPayer,\n    'x-amz-expected-bucket-owner': input.ExpectedBucketOwner\n  });\n  const query = (0, utils_2.assignStringVariables)({\n    'list-type': '2',\n    'continuation-token': input.ContinuationToken,\n    delimiter: input.Delimiter,\n    'encoding-type': input.EncodingType,\n    'fetch-owner': input.FetchOwner,\n    'max-keys': input.MaxKeys,\n    prefix: input.Prefix,\n    'start-after': input.StartAfter\n  });\n  const url = new utils_1.AmplifyUrl(endpoint.url.toString());\n  url.search = new utils_1.AmplifyUrlSearchParams(query).toString();\n  return {\n    method: 'GET',\n    headers,\n    url\n  };\n};\nconst listObjectsV2Deserializer = async response => {\n  if (response.statusCode >= 300) {\n    // error is always set when statusCode >= 300\n    throw (0, utils_2.buildStorageServiceError)(await (0, base_1.parseXmlError)(response));\n  } else {\n    const parsed = await (0, utils_2.parseXmlBody)(response);\n    const contents = (0, utils_2.map)(parsed, {\n      CommonPrefixes: ['CommonPrefixes', value => (0, utils_2.emptyArrayGuard)(value, deserializeCommonPrefixList)],\n      Contents: ['Contents', value => (0, utils_2.emptyArrayGuard)(value, deserializeObjectList)],\n      ContinuationToken: 'ContinuationToken',\n      Delimiter: 'Delimiter',\n      EncodingType: ['EncodingType', deserializeHelpers_1.deserializeStringTag],\n      IsTruncated: ['IsTruncated', utils_2.deserializeBoolean],\n      KeyCount: ['KeyCount', utils_2.deserializeNumber],\n      MaxKeys: ['MaxKeys', utils_2.deserializeNumber],\n      Name: 'Name',\n      NextContinuationToken: 'NextContinuationToken',\n      Prefix: 'Prefix',\n      StartAfter: 'StartAfter'\n    });\n    const output = {\n      $metadata: (0, aws_client_utils_1.parseMetadata)(response),\n      ...contents\n    };\n    validateCorroboratingElements(output);\n    return output;\n  }\n};\nconst deserializeCommonPrefixList = output => output.map(deserializeCommonPrefix);\nconst deserializeCommonPrefix = output => (0, utils_2.map)(output, {\n  Prefix: 'Prefix'\n});\nconst deserializeObjectList = output => output.map(deserializeObject);\nconst deserializeObject = output => (0, utils_2.map)(output, {\n  Key: 'Key',\n  LastModified: ['LastModified', utils_2.deserializeTimestamp],\n  ETag: 'ETag',\n  ChecksumAlgorithm: ['ChecksumAlgorithm', value => (0, utils_2.emptyArrayGuard)(value, deserializeChecksumAlgorithmList)],\n  ChecksumType: ['ChecksumType', deserializeHelpers_1.deserializeStringTag],\n  Size: ['Size', utils_2.deserializeNumber],\n  StorageClass: ['StorageClass', deserializeHelpers_1.deserializeStringTag],\n  Owner: ['Owner', deserializeOwner]\n});\nconst deserializeChecksumAlgorithmList = output => output.map(deserializeHelpers_1.deserializeStringTag);\nconst deserializeOwner = output => (0, utils_2.map)(output, {\n  DisplayName: 'DisplayName',\n  ID: 'ID'\n});\nconst validateCorroboratingElements = response => {\n  const {\n    IsTruncated,\n    KeyCount,\n    Contents = [],\n    CommonPrefixes = [],\n    NextContinuationToken\n  } = response;\n  const validTruncation = IsTruncated && !!NextContinuationToken || !IsTruncated && !NextContinuationToken;\n  const validNumberOfKeysReturned = KeyCount === Contents.length + CommonPrefixes.length;\n  if (!validTruncation || !validNumberOfKeysReturned) {\n    throw new IntegrityError_1.IntegrityError({\n      metadata: response.$metadata\n    });\n  }\n};\nexports.listObjectsV2 = (0, composers_1.composeServiceApi)(utils_2.s3TransferHandler, listObjectsV2Serializer, listObjectsV2Deserializer, {\n  ...base_1.defaultConfig,\n  responseType: 'text'\n});","map":{"version":3,"names":["Object","defineProperty","exports","value","listObjectsV2","aws_client_utils_1","require","utils_1","composers_1","utils_2","IntegrityError_1","deserializeHelpers_1","base_1","listObjectsV2Serializer","input","endpoint","headers","assignStringVariables","RequestPayer","ExpectedBucketOwner","query","ContinuationToken","delimiter","Delimiter","EncodingType","FetchOwner","MaxKeys","prefix","Prefix","StartAfter","url","AmplifyUrl","toString","search","AmplifyUrlSearchParams","method","listObjectsV2Deserializer","response","statusCode","buildStorageServiceError","parseXmlError","parsed","parseXmlBody","contents","map","CommonPrefixes","emptyArrayGuard","deserializeCommonPrefixList","Contents","deserializeObjectList","deserializeStringTag","IsTruncated","deserializeBoolean","KeyCount","deserializeNumber","Name","NextContinuationToken","output","$metadata","parseMetadata","validateCorroboratingElements","deserializeCommonPrefix","deserializeObject","Key","LastModified","deserializeTimestamp","ETag","ChecksumAlgorithm","deserializeChecksumAlgorithmList","ChecksumType","Size","StorageClass","Owner","deserializeOwner","DisplayName","ID","validTruncation","validNumberOfKeysReturned","length","IntegrityError","metadata","composeServiceApi","s3TransferHandler","defaultConfig","responseType"],"sources":["C:\\Users\\vinzl\\workspace\\machicoulis\\daily-image-collector\\node_modules\\@aws-amplify\\storage\\src\\providers\\s3\\utils\\client\\s3data\\listObjectsV2.ts"],"sourcesContent":["\"use strict\";\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.listObjectsV2 = void 0;\nconst aws_client_utils_1 = require(\"@aws-amplify/core/internals/aws-client-utils\");\nconst utils_1 = require(\"@aws-amplify/core/internals/utils\");\nconst composers_1 = require(\"@aws-amplify/core/internals/aws-client-utils/composers\");\nconst utils_2 = require(\"../utils\");\nconst IntegrityError_1 = require(\"../../../../../errors/IntegrityError\");\nconst deserializeHelpers_1 = require(\"../utils/deserializeHelpers\");\nconst base_1 = require(\"./base\");\nconst listObjectsV2Serializer = (input, endpoint) => {\n    const headers = (0, utils_2.assignStringVariables)({\n        'x-amz-request-payer': input.RequestPayer,\n        'x-amz-expected-bucket-owner': input.ExpectedBucketOwner,\n    });\n    const query = (0, utils_2.assignStringVariables)({\n        'list-type': '2',\n        'continuation-token': input.ContinuationToken,\n        delimiter: input.Delimiter,\n        'encoding-type': input.EncodingType,\n        'fetch-owner': input.FetchOwner,\n        'max-keys': input.MaxKeys,\n        prefix: input.Prefix,\n        'start-after': input.StartAfter,\n    });\n    const url = new utils_1.AmplifyUrl(endpoint.url.toString());\n    url.search = new utils_1.AmplifyUrlSearchParams(query).toString();\n    return {\n        method: 'GET',\n        headers,\n        url,\n    };\n};\nconst listObjectsV2Deserializer = async (response) => {\n    if (response.statusCode >= 300) {\n        // error is always set when statusCode >= 300\n        throw (0, utils_2.buildStorageServiceError)((await (0, base_1.parseXmlError)(response)));\n    }\n    else {\n        const parsed = await (0, utils_2.parseXmlBody)(response);\n        const contents = (0, utils_2.map)(parsed, {\n            CommonPrefixes: [\n                'CommonPrefixes',\n                value => (0, utils_2.emptyArrayGuard)(value, deserializeCommonPrefixList),\n            ],\n            Contents: [\n                'Contents',\n                value => (0, utils_2.emptyArrayGuard)(value, deserializeObjectList),\n            ],\n            ContinuationToken: 'ContinuationToken',\n            Delimiter: 'Delimiter',\n            EncodingType: ['EncodingType', (deserializeHelpers_1.deserializeStringTag)],\n            IsTruncated: ['IsTruncated', utils_2.deserializeBoolean],\n            KeyCount: ['KeyCount', utils_2.deserializeNumber],\n            MaxKeys: ['MaxKeys', utils_2.deserializeNumber],\n            Name: 'Name',\n            NextContinuationToken: 'NextContinuationToken',\n            Prefix: 'Prefix',\n            StartAfter: 'StartAfter',\n        });\n        const output = {\n            $metadata: (0, aws_client_utils_1.parseMetadata)(response),\n            ...contents,\n        };\n        validateCorroboratingElements(output);\n        return output;\n    }\n};\nconst deserializeCommonPrefixList = (output) => output.map(deserializeCommonPrefix);\nconst deserializeCommonPrefix = (output) => (0, utils_2.map)(output, {\n    Prefix: 'Prefix',\n});\nconst deserializeObjectList = (output) => output.map(deserializeObject);\nconst deserializeObject = (output) => (0, utils_2.map)(output, {\n    Key: 'Key',\n    LastModified: ['LastModified', utils_2.deserializeTimestamp],\n    ETag: 'ETag',\n    ChecksumAlgorithm: [\n        'ChecksumAlgorithm',\n        value => (0, utils_2.emptyArrayGuard)(value, deserializeChecksumAlgorithmList),\n    ],\n    ChecksumType: ['ChecksumType', (deserializeHelpers_1.deserializeStringTag)],\n    Size: ['Size', utils_2.deserializeNumber],\n    StorageClass: ['StorageClass', (deserializeHelpers_1.deserializeStringTag)],\n    Owner: ['Owner', deserializeOwner],\n});\nconst deserializeChecksumAlgorithmList = (output) => output.map((deserializeHelpers_1.deserializeStringTag));\nconst deserializeOwner = (output) => (0, utils_2.map)(output, { DisplayName: 'DisplayName', ID: 'ID' });\nconst validateCorroboratingElements = (response) => {\n    const { IsTruncated, KeyCount, Contents = [], CommonPrefixes = [], NextContinuationToken, } = response;\n    const validTruncation = (IsTruncated && !!NextContinuationToken) ||\n        (!IsTruncated && !NextContinuationToken);\n    const validNumberOfKeysReturned = KeyCount === Contents.length + CommonPrefixes.length;\n    if (!validTruncation || !validNumberOfKeysReturned) {\n        throw new IntegrityError_1.IntegrityError({ metadata: response.$metadata });\n    }\n};\nexports.listObjectsV2 = (0, composers_1.composeServiceApi)(utils_2.s3TransferHandler, listObjectsV2Serializer, listObjectsV2Deserializer, { ...base_1.defaultConfig, responseType: 'text' });\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}