{"ast":null,"code":"// src/App.js\nimport React,{useEffect,useState}from'react';import{useGameLogic}from'./hooks/useGameLogic';import{Amplify}from'aws-amplify';import{getCurrentUser,signOut}from'aws-amplify/auth';import awsExports from'./aws-exports';import LoginScreen from'./components/LoginScreen';import HomeScreen from'./components/HomeScreen';import CollectionScreen from'./components/CollectionScreen';import NewImageModal from'./components/NewImageModal';import ImageDetailModal from'./components/ImageDetailModal';import'./styles/animations.css';// Import the animations\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";Amplify.configure(awsExports);const DailyImageCollector=()=>{const[authUser,setAuthUser]=useState(null);const[isAuthLoading,setIsAuthLoading]=useState(true);const{user,login,logout:gameLogout,currentView,setCurrentView,userCollection,todaysClaim,drawDailyImage,loading,getStreakCount,imageDatabase,showNewImage,setShowNewImage,todaysImage,shakeAnimation,setShakeAnimation,selectedImage,setSelectedImage,isFullscreen,setIsFullscreen}=useGameLogic();// Check authentication state on app load\nuseEffect(()=>{checkAuthState();},[]);const checkAuthState=async()=>{try{var _cognitoUser$signInDe;const cognitoUser=await getCurrentUser();console.log('Authenticated user found:',cognitoUser);setAuthUser(cognitoUser);// Auto-login with Cognito user data\nconst username=cognitoUser.username;const email=((_cognitoUser$signInDe=cognitoUser.signInDetails)===null||_cognitoUser$signInDe===void 0?void 0:_cognitoUser$signInDe.loginId)||'';login(username,email);}catch(error){console.log('No authenticated user found');setAuthUser(null);}setIsAuthLoading(false);};// Enhanced login function that handles both Cognito and demo users\nconst handleLogin=async(username,email)=>{// For demo/admin users, skip Cognito authentication\nif(username==='demo_user'||username==='admin'){login(username,email);setAuthUser({username,email,isDemoUser:true});return;}// For real users, they should already be authenticated through Cognito\n// This function is called after successful Cognito auth\nlogin(username,email);};// Enhanced logout function\nconst handleLogout=async()=>{try{// Only sign out from Cognito if it's not a demo user\nif(authUser&&!authUser.isDemoUser){await signOut();}setAuthUser(null);gameLogout();}catch(error){console.error('Error signing out:',error);// Force logout even if Cognito signout fails\nsetAuthUser(null);gameLogout();}};// Show loading screen while checking authentication\nif(isAuthLoading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-600 to-blue-600\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-32 w-32 border-b-4 border-white mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-white text-xl font-bold\",children:\"Chargement de Pocket Machicoulis...\"})]})});}// Show login screen if no authenticated user and no game user\nif(!authUser&&!user){return/*#__PURE__*/_jsx(LoginScreen,{login:handleLogin});}return/*#__PURE__*/_jsxs(\"div\",{children:[currentView==='home'&&/*#__PURE__*/_jsx(HomeScreen,{user:user,logout:handleLogout,drawDailyImage:drawDailyImage,loading:loading,todaysClaim:todaysClaim,userCollection:userCollection,getStreakCount:getStreakCount,imageDatabase:imageDatabase,setCurrentView:setCurrentView}),currentView==='collection'&&/*#__PURE__*/_jsx(CollectionScreen,{userCollection:userCollection,imageDatabase:imageDatabase,setCurrentView:setCurrentView,setSelectedImage:setSelectedImage}),/*#__PURE__*/_jsx(NewImageModal,{showNewImage:showNewImage,setShowNewImage:setShowNewImage,todaysImage:todaysImage,shakeAnimation:shakeAnimation,setShakeAnimation:setShakeAnimation}),/*#__PURE__*/_jsx(ImageDetailModal,{selectedImage:selectedImage,setSelectedImage:setSelectedImage,isFullscreen:isFullscreen,setIsFullscreen:setIsFullscreen})]});};export default DailyImageCollector;","map":{"version":3,"names":["React","useEffect","useState","useGameLogic","Amplify","getCurrentUser","signOut","awsExports","LoginScreen","HomeScreen","CollectionScreen","NewImageModal","ImageDetailModal","jsx","_jsx","jsxs","_jsxs","configure","DailyImageCollector","authUser","setAuthUser","isAuthLoading","setIsAuthLoading","user","login","logout","gameLogout","currentView","setCurrentView","userCollection","todaysClaim","drawDailyImage","loading","getStreakCount","imageDatabase","showNewImage","setShowNewImage","todaysImage","shakeAnimation","setShakeAnimation","selectedImage","setSelectedImage","isFullscreen","setIsFullscreen","checkAuthState","_cognitoUser$signInDe","cognitoUser","console","log","username","email","signInDetails","loginId","error","handleLogin","isDemoUser","handleLogout","className","children"],"sources":["C:/Users/vinzl/workspace/machicoulis/daily-image-collector/src/App.js"],"sourcesContent":["// src/App.js\n\nimport React, { useEffect, useState } from 'react';\nimport { useGameLogic } from './hooks/useGameLogic';\nimport { Amplify } from 'aws-amplify';\nimport { getCurrentUser, signOut } from 'aws-amplify/auth';\nimport awsExports from './aws-exports';\nimport LoginScreen from './components/LoginScreen';\nimport HomeScreen from './components/HomeScreen';\nimport CollectionScreen from './components/CollectionScreen';\nimport NewImageModal from './components/NewImageModal';\nimport ImageDetailModal from './components/ImageDetailModal';\nimport './styles/animations.css'; // Import the animations\n\nAmplify.configure(awsExports);\n\nconst DailyImageCollector = () => {\n  const [authUser, setAuthUser] = useState(null);\n  const [isAuthLoading, setIsAuthLoading] = useState(true);\n\n  const {\n    user,\n    login,\n    logout: gameLogout,\n    currentView,\n    setCurrentView,\n    userCollection,\n    todaysClaim,\n    drawDailyImage,\n    loading,\n    getStreakCount,\n    imageDatabase,\n    showNewImage,\n    setShowNewImage,\n    todaysImage,\n    shakeAnimation,\n    setShakeAnimation,\n    selectedImage,\n    setSelectedImage,\n    isFullscreen,\n    setIsFullscreen\n  } = useGameLogic();\n\n  // Check authentication state on app load\n  useEffect(() => {\n    checkAuthState();\n  }, []);\n\n  const checkAuthState = async () => {\n    try {\n      const cognitoUser = await getCurrentUser();\n      console.log('Authenticated user found:', cognitoUser);\n      setAuthUser(cognitoUser);\n      \n      // Auto-login with Cognito user data\n      const username = cognitoUser.username;\n      const email = cognitoUser.signInDetails?.loginId || '';\n      login(username, email);\n    } catch (error) {\n      console.log('No authenticated user found');\n      setAuthUser(null);\n    }\n    setIsAuthLoading(false);\n  };\n\n  // Enhanced login function that handles both Cognito and demo users\n  const handleLogin = async (username, email) => {\n    // For demo/admin users, skip Cognito authentication\n    if (username === 'demo_user' || username === 'admin') {\n      login(username, email);\n      setAuthUser({ username, email, isDemoUser: true });\n      return;\n    }\n\n    // For real users, they should already be authenticated through Cognito\n    // This function is called after successful Cognito auth\n    login(username, email);\n  };\n\n  // Enhanced logout function\n  const handleLogout = async () => {\n    try {\n      // Only sign out from Cognito if it's not a demo user\n      if (authUser && !authUser.isDemoUser) {\n        await signOut();\n      }\n      setAuthUser(null);\n      gameLogout();\n    } catch (error) {\n      console.error('Error signing out:', error);\n      // Force logout even if Cognito signout fails\n      setAuthUser(null);\n      gameLogout();\n    }\n  };\n\n  // Show loading screen while checking authentication\n  if (isAuthLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-600 to-blue-600\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-32 w-32 border-b-4 border-white mb-4\"></div>\n          <p className=\"text-white text-xl font-bold\">Chargement de Pocket Machicoulis...</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Show login screen if no authenticated user and no game user\n  if (!authUser && !user) {\n    return <LoginScreen login={handleLogin} />;\n  }\n\n  return (\n    <div>\n      {currentView === 'home' && (\n        <HomeScreen\n          user={user}\n          logout={handleLogout}\n          drawDailyImage={drawDailyImage}\n          loading={loading}\n          todaysClaim={todaysClaim}\n          userCollection={userCollection}\n          getStreakCount={getStreakCount}\n          imageDatabase={imageDatabase}\n          setCurrentView={setCurrentView}\n        />\n      )}\n      {currentView === 'collection' && (\n        <CollectionScreen\n          userCollection={userCollection}\n          imageDatabase={imageDatabase}\n          setCurrentView={setCurrentView}\n          setSelectedImage={setSelectedImage}\n        />\n      )}\n      <NewImageModal\n        showNewImage={showNewImage}\n        setShowNewImage={setShowNewImage}\n        todaysImage={todaysImage}\n        shakeAnimation={shakeAnimation}\n        setShakeAnimation={setShakeAnimation}\n      />\n      <ImageDetailModal\n        selectedImage={selectedImage}\n        setSelectedImage={setSelectedImage}\n        isFullscreen={isFullscreen}\n        setIsFullscreen={setIsFullscreen}\n      />\n    </div>\n  );\n};\n\nexport default DailyImageCollector;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}