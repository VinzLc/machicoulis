{"ast":null,"code":"'use strict';\n\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getRetryDecider = void 0;\nconst types_1 = require(\"../../../types\");\nconst isClockSkewError_1 = require(\"./isClockSkewError\");\n/**\n * Get retry decider function\n * @param errorParser Function to load JavaScript error from HTTP response\n */\nconst getRetryDecider = errorParser => async (response, error) => {\n  const parsedError = error ?? (await errorParser(response)) ?? undefined;\n  const errorCode = parsedError?.code || parsedError?.name;\n  const statusCode = response?.statusCode;\n  const isRetryable = isConnectionError(error) || isThrottlingError(statusCode, errorCode) || (0, isClockSkewError_1.isClockSkewError)(errorCode) || isServerSideError(statusCode, errorCode);\n  return {\n    retryable: isRetryable\n  };\n};\nexports.getRetryDecider = getRetryDecider;\n// reference: https://github.com/aws/aws-sdk-js-v3/blob/ab0e7be36e7e7f8a0c04834357aaad643c7912c3/packages/service-error-classification/src/constants.ts#L22-L37\nconst THROTTLING_ERROR_CODES = ['BandwidthLimitExceeded', 'EC2ThrottledException', 'LimitExceededException', 'PriorRequestNotComplete', 'ProvisionedThroughputExceededException', 'RequestLimitExceeded', 'RequestThrottled', 'RequestThrottledException', 'SlowDown', 'ThrottledException', 'Throttling', 'ThrottlingException', 'TooManyRequestsException'];\nconst TIMEOUT_ERROR_CODES = ['TimeoutError', 'RequestTimeout', 'RequestTimeoutException'];\nconst isThrottlingError = (statusCode, errorCode) => statusCode === 429 || !!errorCode && THROTTLING_ERROR_CODES.includes(errorCode);\nconst isConnectionError = error => [types_1.AmplifyErrorCode.NetworkError,\n// TODO(vNext): unify the error code `ERR_NETWORK` used by the Storage XHR handler\n'ERR_NETWORK'].includes(error?.name);\nconst isServerSideError = (statusCode, errorCode) => !!statusCode && [500, 502, 503, 504].includes(statusCode) || !!errorCode && TIMEOUT_ERROR_CODES.includes(errorCode);","map":{"version":3,"names":["Object","defineProperty","exports","value","getRetryDecider","types_1","require","isClockSkewError_1","errorParser","response","error","parsedError","undefined","errorCode","code","name","statusCode","isRetryable","isConnectionError","isThrottlingError","isClockSkewError","isServerSideError","retryable","THROTTLING_ERROR_CODES","TIMEOUT_ERROR_CODES","includes","AmplifyErrorCode","NetworkError"],"sources":["C:\\Users\\vinzl\\workspace\\machicoulis\\daily-image-collector\\node_modules\\@aws-amplify\\core\\src\\clients\\middleware\\retry\\defaultRetryDecider.ts"],"sourcesContent":["\"use strict\";\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getRetryDecider = void 0;\nconst types_1 = require(\"../../../types\");\nconst isClockSkewError_1 = require(\"./isClockSkewError\");\n/**\n * Get retry decider function\n * @param errorParser Function to load JavaScript error from HTTP response\n */\nconst getRetryDecider = (errorParser) => async (response, error) => {\n    const parsedError = error ??\n        (await errorParser(response)) ??\n        undefined;\n    const errorCode = parsedError?.code || parsedError?.name;\n    const statusCode = response?.statusCode;\n    const isRetryable = isConnectionError(error) ||\n        isThrottlingError(statusCode, errorCode) ||\n        (0, isClockSkewError_1.isClockSkewError)(errorCode) ||\n        isServerSideError(statusCode, errorCode);\n    return {\n        retryable: isRetryable,\n    };\n};\nexports.getRetryDecider = getRetryDecider;\n// reference: https://github.com/aws/aws-sdk-js-v3/blob/ab0e7be36e7e7f8a0c04834357aaad643c7912c3/packages/service-error-classification/src/constants.ts#L22-L37\nconst THROTTLING_ERROR_CODES = [\n    'BandwidthLimitExceeded',\n    'EC2ThrottledException',\n    'LimitExceededException',\n    'PriorRequestNotComplete',\n    'ProvisionedThroughputExceededException',\n    'RequestLimitExceeded',\n    'RequestThrottled',\n    'RequestThrottledException',\n    'SlowDown',\n    'ThrottledException',\n    'Throttling',\n    'ThrottlingException',\n    'TooManyRequestsException',\n];\nconst TIMEOUT_ERROR_CODES = [\n    'TimeoutError',\n    'RequestTimeout',\n    'RequestTimeoutException',\n];\nconst isThrottlingError = (statusCode, errorCode) => statusCode === 429 ||\n    (!!errorCode && THROTTLING_ERROR_CODES.includes(errorCode));\nconst isConnectionError = (error) => [\n    types_1.AmplifyErrorCode.NetworkError,\n    // TODO(vNext): unify the error code `ERR_NETWORK` used by the Storage XHR handler\n    'ERR_NETWORK',\n].includes(error?.name);\nconst isServerSideError = (statusCode, errorCode) => (!!statusCode && [500, 502, 503, 504].includes(statusCode)) ||\n    (!!errorCode && TIMEOUT_ERROR_CODES.includes(errorCode));\n"],"mappings":";;AACA;AACA;AACAA,MAAM,CAACC,cAAc,CAACC,OAAO,EAAE,YAAY,EAAE;EAAEC,KAAK,EAAE;AAAI,CAAE,CAAC;AAC7DD,OAAO,CAACE,eAAe,GAAG,MAAM;AAChC,MAAMC,OAAO,GAAGC,OAAO,CAAC,gBAAgB,CAAC;AACzC,MAAMC,kBAAkB,GAAGD,OAAO,CAAC,oBAAoB,CAAC;AACxD;AACA;AACA;AACA;AACA,MAAMF,eAAe,GAAII,WAAW,IAAK,OAAOC,QAAQ,EAAEC,KAAK,KAAK;EAChE,MAAMC,WAAW,GAAGD,KAAK,KACpB,MAAMF,WAAW,CAACC,QAAQ,CAAC,CAAC,IAC7BG,SAAS;EACb,MAAMC,SAAS,GAAGF,WAAW,EAAEG,IAAI,IAAIH,WAAW,EAAEI,IAAI;EACxD,MAAMC,UAAU,GAAGP,QAAQ,EAAEO,UAAU;EACvC,MAAMC,WAAW,GAAGC,iBAAiB,CAACR,KAAK,CAAC,IACxCS,iBAAiB,CAACH,UAAU,EAAEH,SAAS,CAAC,IACxC,IAAIN,kBAAkB,CAACa,gBAAgB,EAAEP,SAAS,CAAC,IACnDQ,iBAAiB,CAACL,UAAU,EAAEH,SAAS,CAAC;EAC5C,OAAO;IACHS,SAAS,EAAEL;EACnB,CAAK;AACL,CAAC;AACDf,OAAO,CAACE,eAAe,GAAGA,eAAe;AACzC;AACA,MAAMmB,sBAAsB,GAAG,CAC3B,wBAAwB,EACxB,uBAAuB,EACvB,wBAAwB,EACxB,yBAAyB,EACzB,wCAAwC,EACxC,sBAAsB,EACtB,kBAAkB,EAClB,2BAA2B,EAC3B,UAAU,EACV,oBAAoB,EACpB,YAAY,EACZ,qBAAqB,EACrB,0BAA0B,CAC7B;AACD,MAAMC,mBAAmB,GAAG,CACxB,cAAc,EACd,gBAAgB,EAChB,yBAAyB,CAC5B;AACD,MAAML,iBAAiB,GAAGA,CAACH,UAAU,EAAEH,SAAS,KAAKG,UAAU,KAAK,GAAG,IAClE,CAAC,CAACH,SAAS,IAAIU,sBAAsB,CAACE,QAAQ,CAACZ,SAAS,CAAE;AAC/D,MAAMK,iBAAiB,GAAIR,KAAK,IAAK,CACjCL,OAAO,CAACqB,gBAAgB,CAACC,YAAY;AACzC;AACI,aAAa,CAChB,CAACF,QAAQ,CAACf,KAAK,EAAEK,IAAI,CAAC;AACvB,MAAMM,iBAAiB,GAAGA,CAACL,UAAU,EAAEH,SAAS,KAAM,CAAC,CAACG,UAAU,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAACS,QAAQ,CAACT,UAAU,CAAC,IAC1G,CAAC,CAACH,SAAS,IAAIW,mBAAmB,CAACC,QAAQ,CAACZ,SAAS,CAAE","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}