{"ast":null,"code":"'use strict';\n\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.downloadData = void 0;\nconst core_1 = require(\"@aws-amplify/core\");\nconst utils_1 = require(\"@aws-amplify/core/internals/utils\");\nconst resolveS3ConfigAndInput_1 = require(\"../../utils/resolveS3ConfigAndInput\");\nconst utils_2 = require(\"../../utils\");\nconst s3data_1 = require(\"../../utils/client/s3data\");\nconst userAgent_1 = require(\"../../utils/userAgent\");\nconst utils_3 = require(\"../../../../utils\");\nconst constants_1 = require(\"../../utils/constants\");\nconst downloadData = input => {\n  const abortController = new AbortController();\n  const downloadTask = (0, utils_2.createDownloadTask)({\n    job: downloadDataJob(input, abortController.signal),\n    onCancel: message => {\n      abortController.abort(message);\n    }\n  });\n  return downloadTask;\n};\nexports.downloadData = downloadData;\nconst downloadDataJob = (downloadDataInput, abortSignal) => async () => {\n  const {\n    options: downloadDataOptions\n  } = downloadDataInput;\n  const {\n    bucket,\n    keyPrefix,\n    s3Config,\n    identityId\n  } = await (0, resolveS3ConfigAndInput_1.resolveS3ConfigAndInput)(core_1.Amplify, downloadDataInput);\n  const {\n    inputType,\n    objectKey\n  } = (0, utils_2.validateStorageOperationInput)(downloadDataInput, identityId);\n  (0, utils_2.validateBucketOwnerID)(downloadDataOptions?.expectedBucketOwner);\n  const finalKey = inputType === constants_1.STORAGE_INPUT_KEY ? keyPrefix + objectKey : objectKey;\n  utils_3.logger.debug(`download ${objectKey} from ${finalKey}.`);\n  const {\n    Body: body,\n    LastModified: lastModified,\n    ContentLength: size,\n    ETag: eTag,\n    Metadata: metadata,\n    VersionId: versionId,\n    ContentType: contentType\n  } = await (0, s3data_1.getObject)({\n    ...s3Config,\n    abortSignal,\n    onDownloadProgress: downloadDataOptions?.onProgress,\n    userAgentValue: (0, userAgent_1.getStorageUserAgentValue)(utils_1.StorageAction.DownloadData)\n  }, {\n    Bucket: bucket,\n    Key: finalKey,\n    ...(downloadDataOptions?.bytesRange && {\n      Range: `bytes=${downloadDataOptions.bytesRange.start}-${downloadDataOptions.bytesRange.end}`\n    }),\n    ExpectedBucketOwner: downloadDataOptions?.expectedBucketOwner\n  });\n  const result = {\n    body,\n    lastModified,\n    size,\n    contentType,\n    eTag,\n    metadata,\n    versionId\n  };\n  return inputType === constants_1.STORAGE_INPUT_KEY ? {\n    key: objectKey,\n    ...result\n  } : {\n    path: objectKey,\n    ...result\n  };\n};","map":{"version":3,"names":["Object","defineProperty","exports","value","downloadData","core_1","require","utils_1","resolveS3ConfigAndInput_1","utils_2","s3data_1","userAgent_1","utils_3","constants_1","input","abortController","AbortController","downloadTask","createDownloadTask","job","downloadDataJob","signal","onCancel","message","abort","downloadDataInput","abortSignal","options","downloadDataOptions","bucket","keyPrefix","s3Config","identityId","resolveS3ConfigAndInput","Amplify","inputType","objectKey","validateStorageOperationInput","validateBucketOwnerID","expectedBucketOwner","finalKey","STORAGE_INPUT_KEY","logger","debug","Body","body","LastModified","lastModified","ContentLength","size","ETag","eTag","Metadata","metadata","VersionId","versionId","ContentType","contentType","getObject","onDownloadProgress","onProgress","userAgentValue","getStorageUserAgentValue","StorageAction","DownloadData","Bucket","Key","bytesRange","Range","start","end","ExpectedBucketOwner","result","key","path"],"sources":["C:\\Users\\vinzl\\workspace\\machicoulis\\daily-image-collector\\node_modules\\@aws-amplify\\storage\\src\\providers\\s3\\apis\\internal\\downloadData.ts"],"sourcesContent":["\"use strict\";\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.downloadData = void 0;\nconst core_1 = require(\"@aws-amplify/core\");\nconst utils_1 = require(\"@aws-amplify/core/internals/utils\");\nconst resolveS3ConfigAndInput_1 = require(\"../../utils/resolveS3ConfigAndInput\");\nconst utils_2 = require(\"../../utils\");\nconst s3data_1 = require(\"../../utils/client/s3data\");\nconst userAgent_1 = require(\"../../utils/userAgent\");\nconst utils_3 = require(\"../../../../utils\");\nconst constants_1 = require(\"../../utils/constants\");\nconst downloadData = (input) => {\n    const abortController = new AbortController();\n    const downloadTask = (0, utils_2.createDownloadTask)({\n        job: downloadDataJob(input, abortController.signal),\n        onCancel: (message) => {\n            abortController.abort(message);\n        },\n    });\n    return downloadTask;\n};\nexports.downloadData = downloadData;\nconst downloadDataJob = (downloadDataInput, abortSignal) => async () => {\n    const { options: downloadDataOptions } = downloadDataInput;\n    const { bucket, keyPrefix, s3Config, identityId } = await (0, resolveS3ConfigAndInput_1.resolveS3ConfigAndInput)(core_1.Amplify, downloadDataInput);\n    const { inputType, objectKey } = (0, utils_2.validateStorageOperationInput)(downloadDataInput, identityId);\n    (0, utils_2.validateBucketOwnerID)(downloadDataOptions?.expectedBucketOwner);\n    const finalKey = inputType === constants_1.STORAGE_INPUT_KEY ? keyPrefix + objectKey : objectKey;\n    utils_3.logger.debug(`download ${objectKey} from ${finalKey}.`);\n    const { Body: body, LastModified: lastModified, ContentLength: size, ETag: eTag, Metadata: metadata, VersionId: versionId, ContentType: contentType, } = await (0, s3data_1.getObject)({\n        ...s3Config,\n        abortSignal,\n        onDownloadProgress: downloadDataOptions?.onProgress,\n        userAgentValue: (0, userAgent_1.getStorageUserAgentValue)(utils_1.StorageAction.DownloadData),\n    }, {\n        Bucket: bucket,\n        Key: finalKey,\n        ...(downloadDataOptions?.bytesRange && {\n            Range: `bytes=${downloadDataOptions.bytesRange.start}-${downloadDataOptions.bytesRange.end}`,\n        }),\n        ExpectedBucketOwner: downloadDataOptions?.expectedBucketOwner,\n    });\n    const result = {\n        body,\n        lastModified,\n        size,\n        contentType,\n        eTag,\n        metadata,\n        versionId,\n    };\n    return inputType === constants_1.STORAGE_INPUT_KEY\n        ? { key: objectKey, ...result }\n        : { path: objectKey, ...result };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}